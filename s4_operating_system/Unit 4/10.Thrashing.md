## Thrashing

### What is Thrashing?

**Definition:** A process is busy swapping pages in and out

**Situation:**
- Process doesn't have enough frames
- Page fault rate very high
- Spends more time paging than executing

```
More Processes → Less Frames per Process
               → More Page Faults
               → More Paging
               → Less Execution
               → CPU Idle
```

### Thrashing Scenario

```
1. OS observes low CPU utilization
2. Increases degree of multiprogramming (add more processes)
3. Each process gets fewer frames
4. Page fault rate increases
5. Processes spend time waiting for paging
6. CPU utilization drops further!
7. OS adds even more processes → Thrashing!
```

### CPU Utilization vs Degree of Multiprogramming

```
CPU 
Util
100%|     *
    |    * *
    |   *   *
    |  *     *
 30%| *       *****  ← Thrashing region
    |*             ****
  0%|________________*_____
     1  2  3  4  5  6  7  8  Degree of
                              Multiprogramming
```

**Explanation:**
- Initially: Adding processes → CPU utilization increases
- Optimal point: Maximum CPU utilization
- Beyond optimal: Too many processes → Thrashing → CPU utilization drops

### Effects of Thrashing

**System Performance:**
- Severe performance degradation
- Disk I/O increases drastically
- CPU utilization drops
- System becomes unresponsive

**User Experience:**
- Slow response time
- Applications hang
- System appears frozen

### Causes of Thrashing

1. **Insufficient Memory**
   - Too many processes for available RAM
   - Each process gets very few frames

2. **Poor Locality**
   - Process references scattered across many pages
   - Working set too large for allocated frames

3. **Bad Replacement Algorithm**
   - Replacing frequently used pages
   - Increases page fault rate

4. **Over-commitment**
   - OS allows more processes than system can handle

---

## Preventing Thrashing

### Method 1: Working Set Model

#### What is Working Set?

**Definition:** Set of pages that process is **currently using**

**Working Set (WS):** Pages referenced in most recent Δ page references
- Δ = Working set window (time window)

#### Example

```
Reference string: ...2 6 1 5 7 7 7 5 1 6 2 3 4 1...
                              ↑
                           Current

If Δ = 10 (look back 10 references):
Working Set = {1, 2, 3, 4, 5, 6, 7}
```

#### Working Set Strategy

```
For each process:
1. Calculate working set size (WSS)
2. If WSS > allocated frames → Suspend process
3. If ΣWSs < total frames → Can add more processes
```

**Advantage:** Prevents thrashing by ensuring sufficient frames

### Method 2: Page Fault Frequency (PFF)

#### Concept
- Monitor page fault rate for each process
- Establish acceptable range

```
Upper threshold ──────────  Too many page faults → Increase frames
                           
                            Acceptable range
                           
Lower threshold ──────────  Too few page faults → Decrease frames
```

#### PFF Strategy

```
If page fault rate > Upper threshold:
    Allocate more frames to process
    If no free frames: Suspend a process
    
If page fault rate < Lower threshold:
    Remove frames from process
    Give to other processes
```

**Advantage:** Dynamic adjustment based on actual behavior

### Method 3: Local Replacement

**Strategy:** Each process replaces only its own pages

**Benefit:** One process cannot cause thrashing in others

**Drawback:** May not utilize memory optimally

---
