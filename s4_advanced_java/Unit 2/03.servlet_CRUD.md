# Servlet with MySQL Database - CRUD Operations


---

## What is CRUD?

CRUD stands for the 4 basic database operations:

| Letter | Operation | SQL Command | HTTP Method | Meaning |
|--------|-----------|-------------|-------------|---------|
| **C** | Create | INSERT | POST | Add new data |
| **R** | Read | SELECT | GET | View/fetch data |
| **U** | Update | UPDATE | PUT | Modify existing data |
| **D** | Delete | DELETE | DELETE | Remove data |

---

## What We Will Build

A simple **User Registration System** where we can:
1. Register a new user (CREATE)
2. View all users (READ)
3. Edit user details (UPDATE)
4. Delete a user (DELETE)

---

## Step 1: Setup MySQL Database

First, we need to create our database and table.

### Open MySQL and run these commands:

```sql
-- Step 1: Create a new database
CREATE DATABASE servlet_db;

-- Step 2: Use this database
USE servlet_db;

-- Step 3: Create users table
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100),
    email VARCHAR(100),
    password VARCHAR(100),
    gender VARCHAR(10),
    course VARCHAR(50)
);
```

### Understanding the Table:

```
┌─────────────────────────────────────────────────────────────┐
│                        users TABLE                          │
├──────┬──────────┬────────────────────┬──────────┬──────────┤
│  id  │   name   │       email        │  gender  │  course  │
├──────┼──────────┼────────────────────┼──────────┼──────────┤
│  1   │  Rahul   │  rahul@gmail.com   │   male   │   java   │
│  2   │  Priya   │  priya@gmail.com   │  female  │   react  │
└──────┴──────────┴────────────────────┴──────────┴──────────┘
```

---

## Step 2: Project Structure

Create these files in your project:

```
YourProject/
│
├── src/
│   └── com/
│       └── example/
│           ├── DBConnection.java    ← Connects to database
│           └── UserServlet.java     ← Handles all requests
│
├── webapp/
│   ├── index.html                   ← Registration form
│   └── WEB-INF/
│       └── web.xml                  ← Servlet configuration
│
└── lib/
    └── mysql-connector-java.jar     ← MySQL driver (download it)
```

---

## Step 3: Database Connection Class

This class makes connection to MySQL database.

### DBConnection.java

```java
package com.example;

import java.sql.Connection;
import java.sql.DriverManager;

public class DBConnection {
    
    // Database details - CHANGE THESE according to your MySQL setup
    static String url = "jdbc:mysql://localhost:3306/servlet_db";
    static String username = "root";           // Your MySQL username
    static String password = "your_password";  // Your MySQL password
    
    // This method returns database connection
    public static Connection getConnection() {
        Connection conn = null;
        try {
            // Step 1: Load MySQL driver
            Class.forName("com.mysql.cj.jdbc.Driver");
            
            // Step 2: Create connection
            conn = DriverManager.getConnection(url, username, password);
            
            System.out.println("Database Connected!");
            
        } catch (Exception e) {
            System.out.println("Connection Failed!");
            e.printStackTrace();
        }
        return conn;
    }
}
```

### What each line does:

```java
Class.forName("com.mysql.cj.jdbc.Driver");
// This loads MySQL driver into memory

DriverManager.getConnection(url, username, password);
// This creates actual connection to database
```

---

## Step 4: HTML Registration Form

### index.html

```html
<!DOCTYPE html>
<html>
<head>
    <title>User Registration</title>
    <style>
        body {
            font-family: Arial;
            background: #667eea;
            display: flex;
            justify-content: center;
            padding: 50px;
        }
        .form-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 400px;
        }
        h2 { text-align: center; }
        input, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #5a6fdc; }
    </style>
</head>
<body>
    <div class="form-box">
        <h2>User Registration</h2>
        
        <!-- Form submits to /users servlet using POST method -->
        <form action="users" method="POST">
            
            <label>Name:</label>
            <input type="text" name="name" placeholder="Enter name" required>
            
            <label>Email:</label>
            <input type="email" name="email" placeholder="Enter email" required>
            
            <label>Password:</label>
            <input type="password" name="password" placeholder="Enter password" required>
            
            <label>Gender:</label>
            <select name="gender" required>
                <option value="">Select Gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>
            
            <label>Course:</label>
            <select name="course" required>
                <option value="">Select Course</option>
                <option value="java">Java</option>
                <option value="python">Python</option>
                <option value="react">React</option>
            </select>
            
            <button type="submit">Register</button>
        </form>
        
        <p style="text-align:center; margin-top:15px;">
            <a href="users">View All Users</a>
        </p>
    </div>
</body>
</html>
```

---

## Step 5: The Main Servlet (UserServlet.java)

This is the heart of our application! It handles all CRUD operations.

### UserServlet.java

```java
package com.example;

import javax.servlet.*;
import javax.servlet.http.*;
import java.io.*;
import java.sql.*;

public class UserServlet extends HttpServlet {

    // Database connection
    Connection conn;
    
    // Called when servlet starts
    @Override
    public void init() {
        conn = DBConnection.getConnection();
    }

    // ════════════════════════════════════════════════════════════
    //                    doGET = READ DATA
    // ════════════════════════════════════════════════════════════
    @Override
    public void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        response.setContentType("text/html");
        PrintWriter out = response.getWriter();
        
        // Check if we want single user or all users
        String id = request.getParameter("id");
        
        try {
            out.println("<html><head><title>Users</title>");
            out.println("<style>");
            out.println("body { font-family: Arial; padding: 20px; }");
            out.println("table { border-collapse: collapse; width: 100%; }");
            out.println("th, td { border: 1px solid #ddd; padding: 10px; }");
            out.println("th { background: #667eea; color: white; }");
            out.println("</style></head><body>");
            
            if (id != null) {
                // ═══ Get Single User ═══
                String sql = "SELECT * FROM users WHERE id = ?";
                PreparedStatement ps = conn.prepareStatement(sql);
                ps.setInt(1, Integer.parseInt(id));
                ResultSet rs = ps.executeQuery();
                
                if (rs.next()) {
                    out.println("<h2>User Details</h2>");
                    out.println("<p><b>ID:</b> " + rs.getInt("id") + "</p>");
                    out.println("<p><b>Name:</b> " + rs.getString("name") + "</p>");
                    out.println("<p><b>Email:</b> " + rs.getString("email") + "</p>");
                    out.println("<p><b>Gender:</b> " + rs.getString("gender") + "</p>");
                    out.println("<p><b>Course:</b> " + rs.getString("course") + "</p>");
                } else {
                    out.println("<h2>User not found!</h2>");
                }
            } else {
                // ═══ Get All Users ═══
                String sql = "SELECT * FROM users";
                Statement stmt = conn.createStatement();
                ResultSet rs = stmt.executeQuery(sql);
                
                out.println("<h2>All Users</h2>");
                out.println("<table>");
                out.println("<tr><th>ID</th><th>Name</th><th>Email</th><th>Gender</th><th>Course</th><th>Actions</th></tr>");
                
                while (rs.next()) {
                    out.println("<tr>");
                    out.println("<td>" + rs.getInt("id") + "</td>");
                    out.println("<td>" + rs.getString("name") + "</td>");
                    out.println("<td>" + rs.getString("email") + "</td>");
                    out.println("<td>" + rs.getString("gender") + "</td>");
                    out.println("<td>" + rs.getString("course") + "</td>");
                    out.println("<td>");
                    out.println("<a href='users?id=" + rs.getInt("id") + "'>View</a> | ");
                    out.println("<a href='users?delete=" + rs.getInt("id") + "'>Delete</a>");
                    out.println("</td>");
                    out.println("</tr>");
                }
                out.println("</table>");
            }
            
            out.println("<br><a href='index.html'>← Back to Form</a>");
            out.println("</body></html>");
            
        } catch (SQLException e) {
            out.println("<h2>Error: " + e.getMessage() + "</h2>");
        }
    }

    // ════════════════════════════════════════════════════════════
    //                   doPOST = CREATE DATA
    // ════════════════════════════════════════════════════════════
    @Override
    public void doPost(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        response.setContentType("text/html");
        PrintWriter out = response.getWriter();
        
        // Get form data
        String name = request.getParameter("name");
        String email = request.getParameter("email");
        String password = request.getParameter("password");
        String gender = request.getParameter("gender");
        String course = request.getParameter("course");
        
        try {
            // SQL INSERT query
            String sql = "INSERT INTO users (name, email, password, gender, course) VALUES (?, ?, ?, ?, ?)";
            
            PreparedStatement ps = conn.prepareStatement(sql);
            ps.setString(1, name);
            ps.setString(2, email);
            ps.setString(3, password);
            ps.setString(4, gender);
            ps.setString(5, course);
            
            int result = ps.executeUpdate();
            
            out.println("<html><body style='font-family:Arial; text-align:center; padding:50px;'>");
            
            if (result > 0) {
                out.println("<h2 style='color:green;'>User Registered Successfully!</h2>");
                out.println("<p><b>Name:</b> " + name + "</p>");
                out.println("<p><b>Email:</b> " + email + "</p>");
            } else {
                out.println("<h2 style='color:red;'>Registration Failed!</h2>");
            }
            
            out.println("<a href='users'>View All Users</a> | ");
            out.println("<a href='index.html'>Register Another</a>");
            out.println("</body></html>");
            
        } catch (SQLException e) {
            out.println("<h2>Error: " + e.getMessage() + "</h2>");
        }
    }

    // ════════════════════════════════════════════════════════════
    //                   doPUT = UPDATE DATA
    // ════════════════════════════════════════════════════════════
    @Override
    public void doPut(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        response.setContentType("text/html");
        PrintWriter out = response.getWriter();
        
        // Get parameters
        int id = Integer.parseInt(request.getParameter("id"));
        String name = request.getParameter("name");
        String email = request.getParameter("email");
        
        try {
            // SQL UPDATE query
            String sql = "UPDATE users SET name = ?, email = ? WHERE id = ?";
            
            PreparedStatement ps = conn.prepareStatement(sql);
            ps.setString(1, name);
            ps.setString(2, email);
            ps.setInt(3, id);
            
            int result = ps.executeUpdate();
            
            out.println("<html><body style='font-family:Arial; text-align:center; padding:50px;'>");
            
            if (result > 0) {
                out.println("<h2 style='color:green;'>User Updated Successfully!</h2>");
            } else {
                out.println("<h2 style='color:red;'>Update Failed! User not found.</h2>");
            }
            
            out.println("<a href='users'>View All Users</a>");
            out.println("</body></html>");
            
        } catch (SQLException e) {
            out.println("<h2>Error: " + e.getMessage() + "</h2>");
        }
    }

    // ════════════════════════════════════════════════════════════
    //                  doDELETE = DELETE DATA
    // ════════════════════════════════════════════════════════════
    @Override
    public void doDelete(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        response.setContentType("text/html");
        PrintWriter out = response.getWriter();
        
        int id = Integer.parseInt(request.getParameter("id"));
        
        try {
            // SQL DELETE query
            String sql = "DELETE FROM users WHERE id = ?";
            
            PreparedStatement ps = conn.prepareStatement(sql);
            ps.setInt(1, id);
            
            int result = ps.executeUpdate();
            
            out.println("<html><body style='font-family:Arial; text-align:center; padding:50px;'>");
            
            if (result > 0) {
                out.println("<h2 style='color:green;'>User Deleted Successfully!</h2>");
            } else {
                out.println("<h2 style='color:red;'>Delete Failed! User not found.</h2>");
            }
            
            out.println("<a href='users'>View All Users</a>");
            out.println("</body></html>");
            
        } catch (SQLException e) {
            out.println("<h2>Error: " + e.getMessage() + "</h2>");
        }
    }
}
```

---

## Understanding Each Method

### 1️. doGet() - READ Operation

```
Browser Request:  GET /users        →  Shows ALL users
                  GET /users?id=1   →  Shows user with ID 1
```

```java
// Get all users
String sql = "SELECT * FROM users";
Statement stmt = conn.createStatement();
ResultSet rs = stmt.executeQuery(sql);

// Loop through results
while (rs.next()) {
    rs.getInt("id");       // Get id column
    rs.getString("name");  // Get name column
}
```

---

### 2️. doPost() - CREATE Operation

```
Form Submission:  POST /users  →  Creates new user
```

```java
// Get form data
String name = request.getParameter("name");

// Insert into database
String sql = "INSERT INTO users (name, email) VALUES (?, ?)";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, name);     // Set first ? value
ps.setString(2, email);    // Set second ? value
ps.executeUpdate();        // Run the query
```

---

### 3️. doPut() - UPDATE Operation

```
Request:  PUT /users?id=1&name=NewName  →  Updates user 1
```

```java
String sql = "UPDATE users SET name = ? WHERE id = ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, name);
ps.setInt(2, id);
ps.executeUpdate();
```

---

### 4️. doDelete() - DELETE Operation

```
Request:  DELETE /users?id=1  →  Deletes user 1
```

```java
String sql = "DELETE FROM users WHERE id = ?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setInt(1, id);
ps.executeUpdate();
```

---

## Step 6: web.xml Configuration

### WEB-INF/web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="4.0" 
         xmlns="http://xmlns.jcp.org/xml/ns/javaee">
    
    <!-- Welcome page -->
    <welcome-file-list>
        <welcome-file>index.html</welcome-file>
    </welcome-file-list>
    
    <!-- Declare our servlet -->
    <servlet>
        <servlet-name>UserServlet</servlet-name>
        <servlet-class>com.example.UserServlet</servlet-class>
    </servlet>
    
    <!-- Map URL to servlet -->
    <servlet-mapping>
        <servlet-name>UserServlet</servlet-name>
        <url-pattern>/users</url-pattern>
    </servlet-mapping>
    
</web-app>
```

---

## How It All Works Together

```
┌─────────────────────────────────────────────────────────────────┐
│                         THE FLOW                                 │
└─────────────────────────────────────────────────────────────────┘

    ┌──────────────┐     1. User fills form      ┌──────────────┐
    │              │ ─────────────────────────►  │              │
    │   Browser    │                             │  index.html  │
    │              │ ◄─────────────────────────  │    (Form)    │
    └──────────────┘     Shows form              └──────────────┘
           │
           │ 2. Form submitted (POST /users)
           ▼
    ┌──────────────┐
    │              │
    │ UserServlet  │ ◄── doPost() handles request
    │              │
    └──────────────┘
           │
           │ 3. Servlet uses DBConnection
           ▼
    ┌──────────────┐
    │              │
    │ DBConnection │ ◄── Creates MySQL connection
    │              │
    └──────────────┘
           │
           │ 4. Executes SQL query
           ▼
    ┌──────────────┐
    │              │
    │   MySQL DB   │ ◄── Data stored in 'users' table
    │              │
    └──────────────┘
           │
           │ 5. Success/Failure response
           ▼
    ┌──────────────┐
    │              │
    │   Browser    │ ◄── Shows result to user
    │              │
    └──────────────┘
```

---

## Summary: HTTP Method → Servlet Method → SQL

| When User Does | HTTP Method | Servlet Calls | SQL Runs |
|----------------|-------------|---------------|----------|
| Opens page with data | GET | `doGet()` | SELECT |
| Submits form | POST | `doPost()` | INSERT |
| Updates data | PUT | `doPut()` | UPDATE |
| Deletes data | DELETE | `doDelete()` | DELETE |

---

## Common Errors & Solutions

| Error | Cause | Solution |
|-------|-------|----------|
| `ClassNotFoundException` | MySQL driver missing | Add `mysql-connector-java.jar` to lib folder |
| `Connection refused` | MySQL not running | Start MySQL service |
| `Access denied` | Wrong password | Check username/password in DBConnection |
| `Table doesn't exist` | Database not created | Run the SQL commands from Step 1 |

---

## Testing Your Application

1. **Start Tomcat** server
2. **Open browser**: `http://localhost:8080/YourProject/`
3. **Register a user** using the form
4. **View all users**: `http://localhost:8080/YourProject/users`

---

## Key Points to Remember

1. **PreparedStatement** is safer than Statement (prevents SQL injection)

2. **request.getParameter("name")** gets value from form field with `name="name"`

3. **executeUpdate()** is for INSERT, UPDATE, DELETE (returns number of rows affected)

4. **executeQuery()** is for SELECT (returns ResultSet)

5. **ResultSet.next()** moves to next row, returns false when no more rows

---
