# Java Servlets

---

## What is a Servlet?

**Servlet** is a **simple Java program** that:
- Runs on a **server** (not on client)
- Is capable of **handling requests** from clients
- Generates **dynamic responses**

### Key Characteristics:
- Server-side technology
- Platform-independent
- Extends server capabilities
- Uses request-response model
- Part of Java EE (Enterprise Edition)

---

## Servlet Architecture

```
┌─────────────────┐                           ┌─────────────────┐
│     Client      │                           │     Server      │
│                 │                           │                 │
│   - Browser     │        Request            │  ┌───────────┐  │
│   - Chrome      │  ───────────────────────> │  │   Java    │  │
│   - Firefox     │                           │  │  Program  │  │
│                 │        Response           │  │ (Servlet) │  │
│                 │  <─────────────────────── │  └───────────┘  │
└─────────────────┘                           │       ↕         │
                                              │   Database      │
                                              └─────────────────┘
```

### How it Works:
1. Client sends an HTTP request to the server
2. Server forwards the request to the appropriate Servlet
3. Servlet processes the request (may interact with database)
4. Servlet generates dynamic HTML response
5. Server sends the response back to client

---

## Creating Servlet using javax.servlet.Servlet Interface

### The Servlet Interface

The `javax.servlet.Servlet` interface has **5 methods** that must be implemented:

#### **Lifecycle Methods** (3)
1. `public void init(ServletConfig config)` - Initialization
2. `public void service(ServletRequest req, ServletResponse resp)` - Request processing
3. `public void destroy()` - Cleanup

#### **Non-Lifecycle Methods** (2)
4. `public ServletConfig getServletConfig()` - Get configuration
5. `public String getServletInfo()` - Get servlet information

---

## Servlet Lifecycle Methods

### 1. `init()` Method

**Purpose**: Initialize the servlet (called only once)

**When Called**: When servlet is first loaded into memory

**Signature**:
```java
public void init(ServletConfig conf)
```

**Example**:
```java
ServletConfig conf;

public void init(ServletConfig conf) {
    this.conf = conf;
    System.out.println("Creating object...");
}
```

**Key Points**:
- Called only **once** when servlet is loaded
- Used for one-time initialization tasks
- Receives `ServletConfig` object as parameter
- Must store `ServletConfig` for later use

---

### 2. `service()` Method

**Purpose**: Handle client requests

**When Called**: Every time a request comes to the servlet

**Signature**:
```java
public void service(ServletRequest req, ServletResponse resp) 
    throws ServletException, IOException
```

**Example**:
```java
public void service(ServletRequest req, ServletResponse resp) 
    throws ServletException, IOException {
    
    System.out.println("Servicing...");
    
    // Set content type
    resp.setContentType("text/html");
    
    // Get PrintWriter to send response
    PrintWriter out = resp.getWriter();
    
    // Generate dynamic HTML
    out.println("<h1>This is the output for servlet...</h1>");
    out.println("<h2>Today's Date and Time is " + new Date().toString() + "</h2>");
}
```

**Key Points**:
- Called **every time** a request is received
- Receives `ServletRequest` and `ServletResponse` objects
- Can throw `ServletException` and `IOException`
- Main business logic goes here

---

### 3. `destroy()` Method

**Purpose**: Cleanup before servlet is removed from memory

**When Called**: Before servlet is destroyed

**Signature**:
```java
public void destroy()
```

**Example**:
```java
public void destroy() {
    System.out.println("Destroying Servlet Object...");
}
```

**Key Points**:
- Called only **once** before servlet is removed
- Used for cleanup (close connections, release resources)
- No parameters
- Cannot throw exceptions

---

### Servlet Lifecycle Diagram

```
┌─────────────────────────────────────────────────────────┐
│                    SERVLET LIFECYCLE                     │
└─────────────────────────────────────────────────────────┘

    Servlet Class Loaded
            ↓
    ┌───────────────┐
    │  init()       │  ← Called once
    │  (Initialize) │
    └───────────────┘
            ↓
    ┌───────────────┐
    │  service()    │  ← Called multiple times
    │  (Handle Req) │     (for each request)
    └───────────────┘
            ↑ │
            └─┘ (loop for each request)
            ↓
    ┌───────────────┐
    │  destroy()    │  ← Called once
    │  (Cleanup)    │
    └───────────────┘
            ↓
    Servlet Destroyed
```

---

## Non-Lifecycle Methods

### 4. `getServletConfig()` Method

**Purpose**: Returns the `ServletConfig` object

**Signature**:
```java
public ServletConfig getServletConfig()
```

**Example**:
```java
public ServletConfig getServletConfig() {
    return this.conf;
}
```

---

### 5. `getServletInfo()` Method

**Purpose**: Returns information about the servlet

**Signature**:
```java
public String getServletInfo()
```

**Example**:
```java
public String getServletInfo() {
    return "Servlet is created...";
}
```

---

## Servlet Configuration (web.xml)

The `web.xml` file is the **deployment descriptor** that configures servlets.

### Structure:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee 
         http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <!-- SERVLET DECLARATION -->
    <servlet>
        <servlet-name>hello</servlet-name>
        <servlet-class>com.example.javaservletjakarta.HelloServlet</servlet-class>
    </servlet>

    <!-- URL MAPPING -->
    <servlet-mapping>
        <servlet-name>hello</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>

</web-app>
```

### Components Explained:

#### 1. **Servlet Declaration** (`<servlet>`)
- **`<servlet-name>`**: Logical name for the servlet (can be anything)
- **`<servlet-class>`**: Fully qualified class name (package + class)

#### 2. **URL Mapping** (`<servlet-mapping>`)
- **`<servlet-name>`**: Must match the name in servlet declaration
- **`<url-pattern>`**: URL pattern to access the servlet

### How Mapping Works:

```
URL: http://localhost:8080/your-app/hello
                                    └─────┘
                                       ↓
                            Matches /hello pattern
                                       ↓
                            Invokes 'hello' servlet
                                       ↓
                    Executes HelloServlet.service()
```

---

## Complete Example

### HelloServlet.java

```java
package com.example.javaservletjakarta;

import javax.servlet.*;
import java.io.IOException;
import java.io.PrintWriter;
import java.util.Date;

public class HelloServlet implements Servlet {
    ServletConfig conf;
    
    // ========== LIFECYCLE METHODS ==========
    
    /**
     * Initialization method - called once
     */
    public void init(ServletConfig conf) {
        this.conf = conf;
        System.out.println("Creating object...");
    }

    /**
     * Service method - called for each request
     */
    public void service(ServletRequest req, ServletResponse resp) 
        throws ServletException, IOException {
        
        System.out.println("Servicing...");
        
        // Set the content type of the response
        resp.setContentType("text/html");
        
        // Get PrintWriter to write response
        PrintWriter out = resp.getWriter();
        
        // Generate dynamic HTML
        out.println("<h1>This is the output for servlet...</h1>");
        out.println("<h2>Today's Date and Time is " + new Date().toString() + "</h2>");
    }

    /**
     * Destroy method - called once before servlet is removed
     */
    public void destroy() {
        System.out.println("Destroying Servlet Object...");
    }

    // ========== NON-LIFECYCLE METHODS ==========
    
    /**
     * Returns ServletConfig object
     */
    public ServletConfig getServletConfig() {
        return this.conf;
    }

    /**
     * Returns servlet information
     */
    public String getServletInfo() {
        return "Servlet is created...";
    }
}
```

---

## Quick Reference

### Servlet Interface Methods

| Method | Type | Called | Purpose |
|--------|------|--------|---------|
| `init(ServletConfig)` | Lifecycle | Once (at startup) | Initialize servlet |
| `service(Request, Response)` | Lifecycle | Multiple (per request) | Handle requests |
| `destroy()` | Lifecycle | Once (at shutdown) | Cleanup resources |
| `getServletConfig()` | Non-lifecycle | When needed | Get configuration |
| `getServletInfo()` | Non-lifecycle | When needed | Get servlet info |

### web.xml Components

```xml
<servlet>                    <!-- Servlet Declaration -->
  <servlet-name>             <!-- Logical name -->
  <servlet-class>            <!-- Fully qualified class name -->

<servlet-mapping>            <!-- URL Mapping -->
  <servlet-name>             <!-- Reference to servlet name -->
  <url-pattern>              <!-- URL pattern -->
```

### Request-Response Flow

```
Client Request → Web Server → Servlet Container → 
    → init() [if first time] → service() → destroy() [at shutdown]
    → Response generated → Sent to Client
```

---

## Important Notes

### Common Mistakes

1. **Missing space in HTML tag**:
   ```java
   // WRONG
   out.println("< /h2>");  // Space in closing tag
   
   // CORRECT
   out.println("</h2>");
   ```

2. **Not storing ServletConfig**:
   ```java
   // Store it for later use in getServletConfig()
   this.conf = conf;
   ```

3. **URL pattern mismatch**: Ensure `<servlet-name>` matches in both declaration and mapping

### Best Practices

1. Always close resources in `destroy()` method
2. Set content type before writing response
3. Handle exceptions properly
4. Use meaningful servlet names
5. Comment your code

---

## Practice Exercise

### Exercise 1: Create a Date-Time Servlet
Create a servlet that displays:
- Current date
- Current time
- Day of the week
- Time zone

### Exercise 2: Modify web.xml
Add multiple URL patterns for the same servlet:
```xml
<servlet-mapping>
    <servlet-name>hello</servlet-name>
    <url-pattern>/hello</url-pattern>
</servlet-mapping>
<servlet-mapping>
    <servlet-name>hello</servlet-name>
    <url-pattern>/greet</url-pattern>
</servlet-mapping>
```

---
