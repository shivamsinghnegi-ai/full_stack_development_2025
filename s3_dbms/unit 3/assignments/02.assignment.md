# ðŸ“˜ Unit 3 â€” Assignment 3

**Domain:** Professional networking â€” **CodingGita Network (CG-Link)**
**Scope:** Very extensive (75 tasks)

---

## A) One-time Setup (run first)

> Dialect: ANSI-SQL leaning to MySQL/Postgres.
> For Postgres: use `SERIAL/BIGSERIAL`; for MySQL you can replace with `BIGINT AUTO_INCREMENT` where needed.

```sql
-- Create DB and switch (MySQL uses: USE CgLinkDB;)
CREATE DATABASE CgLinkDB;
-- PostgreSQL: \c cglinkdb
-- MySQL:
USE CgLinkDB;

-- Core users & profiles
CREATE TABLE AppUser (
  UserID        BIGINT PRIMARY KEY,
  FullName      VARCHAR(80) NOT NULL,
  Email         VARCHAR(120) UNIQUE NOT NULL,
  Headline      VARCHAR(140),
  City          VARCHAR(60),
  Country       VARCHAR(60) DEFAULT 'India',
  CreatedAt     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE Profile (
  UserID        BIGINT PRIMARY KEY,
  About         VARCHAR(400),
  OpenToWork    BOOLEAN DEFAULT TRUE,
  OpenToHire    BOOLEAN DEFAULT FALSE,
  Website       VARCHAR(150),
  CONSTRAINT fk_profile_user FOREIGN KEY (UserID) REFERENCES AppUser(UserID)
);

-- Companies & pages
CREATE TABLE Company (
  CompanyID     BIGINT PRIMARY KEY,
  Name          VARCHAR(120) UNIQUE NOT NULL,
  Industry      VARCHAR(60),
  HQCity        VARCHAR(60),
  HQCountry     VARCHAR(60),
  FoundedYear   INT CHECK (FoundedYear BETWEEN 1800 AND 2100)
);

CREATE TABLE CompanyFollow (
  UserID     BIGINT NOT NULL,
  CompanyID  BIGINT NOT NULL,
  FollowedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (UserID, CompanyID),
  FOREIGN KEY (UserID) REFERENCES AppUser(UserID),
  FOREIGN KEY (CompanyID) REFERENCES Company(CompanyID)
);

-- Education & Experience
CREATE TABLE Education (
  EduID       BIGINT PRIMARY KEY,
  UserID      BIGINT NOT NULL,
  School      VARCHAR(120) NOT NULL,
  Degree      VARCHAR(80),
  Field       VARCHAR(80),
  StartYear   INT,
  EndYear     INT,
  FOREIGN KEY (UserID) REFERENCES AppUser(UserID)
);

CREATE TABLE Experience (
  ExpID       BIGINT PRIMARY KEY,
  UserID      BIGINT NOT NULL,
  CompanyID   BIGINT,
  Title       VARCHAR(120) NOT NULL,
  StartDate   DATE NOT NULL,
  EndDate     DATE,
  CurrentRole BOOLEAN DEFAULT FALSE,
  Location    VARCHAR(120),
  FOREIGN KEY (UserID) REFERENCES AppUser(UserID),
  FOREIGN KEY (CompanyID) REFERENCES Company(CompanyID)
);

-- Skills & endorsements
CREATE TABLE Skill (
  SkillID    BIGINT PRIMARY KEY,
  SkillName  VARCHAR(80) UNIQUE NOT NULL
);

CREATE TABLE UserSkill (
  UserID     BIGINT NOT NULL,
  SkillID    BIGINT NOT NULL,
  Proficiency VARCHAR(20) CHECK (Proficiency IN ('BEGINNER','INTERMEDIATE','ADVANCED','EXPERT')),
  PRIMARY KEY (UserID, SkillID),
  FOREIGN KEY (UserID) REFERENCES AppUser(UserID),
  FOREIGN KEY (SkillID) REFERENCES Skill(SkillID)
);

CREATE TABLE Endorsement (
  EndorseID  BIGINT PRIMARY KEY,
  EndorserID BIGINT NOT NULL,
  EndorsedID BIGINT NOT NULL,
  SkillID    BIGINT NOT NULL,
  EndorsedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (EndorserID) REFERENCES AppUser(UserID),
  FOREIGN KEY (EndorsedID) REFERENCES AppUser(UserID),
  FOREIGN KEY (SkillID) REFERENCES Skill(SkillID)
);

-- Connections (mutual relationship) & follows (one-way)
CREATE TABLE Connection (
  AUserID   BIGINT NOT NULL,
  BUserID   BIGINT NOT NULL,
  SinceDate DATE NOT NULL,
  PRIMARY KEY (AUserID, BUserID),
  FOREIGN KEY (AUserID) REFERENCES AppUser(UserID),
  FOREIGN KEY (BUserID) REFERENCES AppUser(UserID)
);

CREATE TABLE Follow (
  FollowerID BIGINT NOT NULL,
  FolloweeID BIGINT NOT NULL,
  FollowedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (FollowerID, FolloweeID),
  FOREIGN KEY (FollowerID) REFERENCES AppUser(UserID),
  FOREIGN KEY (FolloweeID) REFERENCES AppUser(UserID)
);

-- Posts, comments, reactions, hashtags
CREATE TABLE Post (
  PostID     BIGINT PRIMARY KEY,
  AuthorID   BIGINT NOT NULL,
  Body       VARCHAR(500) NOT NULL,
  CreatedAt  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  Visibility VARCHAR(10) DEFAULT 'PUBLIC' CHECK (Visibility IN ('PUBLIC','CONNECTIONS')),
  FOREIGN KEY (AuthorID) REFERENCES AppUser(UserID)
);

CREATE TABLE Comment (
  CommentID  BIGINT PRIMARY KEY,
  PostID     BIGINT NOT NULL,
  AuthorID   BIGINT NOT NULL,
  Body       VARCHAR(400) NOT NULL,
  CreatedAt  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (PostID) REFERENCES Post(PostID),
  FOREIGN KEY (AuthorID) REFERENCES AppUser(UserID)
);

CREATE TABLE Reaction (
  ReactionID BIGINT PRIMARY KEY,
  PostID     BIGINT NOT NULL,
  UserID     BIGINT NOT NULL,
  Type       VARCHAR(12) CHECK (Type IN ('LIKE','CELEBRATE','LOVE','INSIGHTFUL','CURIOUS')),
  ReactedAt  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  UNIQUE (PostID, UserID),
  FOREIGN KEY (PostID) REFERENCES Post(PostID),
  FOREIGN KEY (UserID) REFERENCES AppUser(UserID)
);

CREATE TABLE Hashtag (
  TagID    BIGINT PRIMARY KEY,
  TagText  VARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE PostHashtag (
  PostID BIGINT NOT NULL,
  TagID  BIGINT NOT NULL,
  PRIMARY KEY (PostID, TagID),
  FOREIGN KEY (PostID) REFERENCES Post(PostID),
  FOREIGN KEY (TagID) REFERENCES Hashtag(TagID)
);

-- Groups & memberships
CREATE TABLE CgGroup (
  GroupID    BIGINT PRIMARY KEY,
  Name       VARCHAR(120) UNIQUE NOT NULL,
  About      VARCHAR(300),
  OwnerID    BIGINT NOT NULL,
  FOREIGN KEY (OwnerID) REFERENCES AppUser(UserID)
);

CREATE TABLE GroupMember (
  GroupID   BIGINT NOT NULL,
  UserID    BIGINT NOT NULL,
  Role      VARCHAR(20) DEFAULT 'MEMBER' CHECK (Role IN ('OWNER','ADMIN','MEMBER')),
  JoinedAt  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (GroupID, UserID),
  FOREIGN KEY (GroupID) REFERENCES CgGroup(GroupID),
  FOREIGN KEY (UserID) REFERENCES AppUser(UserID)
);

-- Jobs & applications
CREATE TABLE Job (
  JobID       BIGINT PRIMARY KEY,
  CompanyID   BIGINT NOT NULL,
  Title       VARCHAR(120) NOT NULL,
  Location    VARCHAR(120),
  PostedAt    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  Employment  VARCHAR(20) CHECK (Employment IN ('FULLTIME','PARTTIME','INTERN','CONTRACT')),
  IsActive    BOOLEAN DEFAULT TRUE,
  FOREIGN KEY (CompanyID) REFERENCES Company(CompanyID)
);

CREATE TABLE JobApplication (
  AppID     BIGINT PRIMARY KEY,
  JobID     BIGINT NOT NULL,
  UserID    BIGINT NOT NULL,
  AppliedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  Status    VARCHAR(20) DEFAULT 'APPLIED' CHECK (Status IN ('APPLIED','SHORTLISTED','REJECTED','HIRED')),
  FOREIGN KEY (JobID) REFERENCES Job(JobID),
  FOREIGN KEY (UserID) REFERENCES AppUser(UserID)
);

-- Seed data (minimal but diverse)
INSERT INTO AppUser (UserID, FullName, Email, Headline, City, Country) VALUES
(101,'Jenil Shah','jenil@codinggita.in','Full-stack at CodingGita','Ahmedabad','India'),
(102,'Mahir Patel','mahir@codinggita.in','Backend Dev (Node.js)','Surat','India'),
(103,'Arjun Mehta','arjun@codinggita.in','Frontend Dev (React)','Vadodara','India'),
(104,'Yashvi Rao','yashvi@codinggita.in','Data Analyst','Rajkot','India'),
(105,'Neel Joshi','neel@codinggita.in','DevOps Intern','Surat','India'),
(106,'Krishna Dave','krishna@codinggita.in','UI/UX Designer','Ahmedabad','India');

INSERT INTO Profile (UserID, About, OpenToWork, OpenToHire, Website) VALUES
(101,'Love building SaaS with MERN.',TRUE,FALSE,'https://codinggita.in'),
(102,'APIs, microservices, SQL wizard.',TRUE,FALSE,NULL),
(103,'React, Next.js, web perf.',TRUE,FALSE,NULL),
(104,'Numbersâ†’Insights.',TRUE,TRUE,'https://analytics.codinggita.in'),
(105,'Automating infra on cloud.',TRUE,FALSE,NULL),
(106,'Designing for humans.',TRUE,FALSE,'https://ux.codinggita.in');

INSERT INTO Company (CompanyID, Name, Industry, HQCity, HQCountry, FoundedYear) VALUES
(201,'CodingGita','EdTech','Ahmedabad','India',2021),
(202,'CG Cloud','Cloud','Mumbai','India',2023),
(203,'CG Analytics','Analytics','Surat','India',2022);

INSERT INTO Education (EduID, UserID, School, Degree, Field, StartYear, EndYear) VALUES
(301,101,'CodingGita University','B.Tech','CSE',2021,2025),
(302,102,'GU','B.Tech','CSE',2020,2024),
(303,103,'GU','B.Tech','IT',2020,2024),
(304,104,'GU','B.Sc','Data Science',2019,2022);

INSERT INTO Experience (ExpID, UserID, CompanyID, Title, StartDate, EndDate, CurrentRole, Location) VALUES
(401,101,201,'SDE Intern','2024-05-01','2024-12-31',FALSE,'Ahmedabad'),
(402,102,202,'Backend Intern','2024-06-01',NULL,TRUE,'Mumbai'),
(403,104,203,'Data Analyst','2023-08-01',NULL,TRUE,'Surat');

INSERT INTO Skill (SkillID, SkillName) VALUES
(501,'SQL'),(502,'JavaScript'),(503,'React'),(504,'Node.js'),(505,'Data Analysis'),(506,'UI/UX');

INSERT INTO UserSkill (UserID, SkillID, Proficiency) VALUES
(101,501,'ADVANCED'),(101,502,'ADVANCED'),(101,503,'ADVANCED'),(101,504,'ADVANCED'),
(102,501,'ADVANCED'),(102,504,'EXPERT'),
(103,502,'ADVANCED'),(103,503,'EXPERT'),
(104,501,'ADVANCED'),(104,505,'EXPERT'),
(106,506,'EXPERT');

INSERT INTO Endorsement (EndorseID, EndorserID, EndorsedID, SkillID) VALUES
(601,102,101,504),(602,103,101,503),(603,101,104,505),(604,104,102,501);

INSERT INTO Connection (AUserID, BUserID, SinceDate) VALUES
(101,102,'2024-07-01'),(101,103,'2024-07-10'),(102,104,'2024-08-01'),
(103,104,'2024-09-01'),(105,101,'2025-01-01');

INSERT INTO Follow (FollowerID, FolloweeID) VALUES
(101,104),(102,101),(103,101),(105,101),(106,101);

INSERT INTO Post (PostID, AuthorID, Body, Visibility, CreatedAt) VALUES
(701,101,'Built a new MERN feature for CodingGita students! #mern #codinggita','PUBLIC','2025-08-10 10:00'),
(702,104,'Analyzed student data trends. #data #codinggita','PUBLIC','2025-08-11 09:00'),
(703,102,'Launched a new Node.js microservice. #nodejs','CONNECTIONS','2025-08-12 20:00');

INSERT INTO Comment (CommentID, PostID, AuthorID, Body, CreatedAt) VALUES
(801,701,103,'Congrats, ship it!','2025-08-10 10:30'),
(802,702,101,'Great insights ðŸ‘','2025-08-11 10:05');

INSERT INTO Reaction (ReactionID, PostID, UserID, Type, ReactedAt) VALUES
(901,701,102,'LIKE','2025-08-10 11:00'),
(902,701,104,'CELEBRATE','2025-08-10 11:05'),
(903,702,101,'INSIGHTFUL','2025-08-11 11:10');

INSERT INTO Hashtag (TagID, TagText) VALUES
(1001,'mern'),(1002,'codinggita'),(1003,'data'),(1004,'nodejs');

INSERT INTO PostHashtag (PostID, TagID) VALUES
(701,1001),(701,1002),(702,1003),(702,1002),(703,1004);

INSERT INTO CgGroup (GroupID, Name, About, OwnerID) VALUES
(1101,'CodingGita Alumni','For CG grads','101'),
(1102,'CG React Builders','React projects & tips','103');

INSERT INTO GroupMember (GroupID, UserID, Role) VALUES
(1101,101,'OWNER'),(1101,102,'MEMBER'),(1101,104,'ADMIN'),
(1102,103,'OWNER'),(1102,101,'MEMBER');

INSERT INTO CompanyFollow (UserID, CompanyID) VALUES
(101,201),(102,201),(103,203),(104,203),(106,202);

INSERT INTO Job (JobID, CompanyID, Title, Location, Employment, IsActive, PostedAt) VALUES
(1201,201,'SDE Intern','Ahmedabad','INTERN',TRUE,'2025-08-01 09:00'),
(1202,203,'Data Analyst','Surat','FULLTIME',TRUE,'2025-08-05 12:00'),
(1203,202,'Node.js Engineer','Mumbai','FULLTIME',TRUE,'2025-08-06 12:00');

INSERT INTO JobApplication (AppID, JobID, UserID, Status, AppliedAt) VALUES
(1301,1201,101,'APPLIED','2025-08-10 12:00'),
(1302,1202,104,'SHORTLISTED','2025-08-12 13:00'),
(1303,1203,102,'APPLIED','2025-08-13 14:00');
```

---

## B) Tasks (75 tasks)

> Keep all answers in a single `.sql` script. Where a task is meant to fail (constraints), capture the DB error as a **SQL comment** right after the statement.

### DDL â€” Create/Alter/Drop (1â€“12)

1. **ALTER Profile**: add column `Github VARCHAR(120)` default `NULL`.
2. **ALTER AppUser**: widen `Headline` to `VARCHAR(200)`.
3. Add `CHECK` on `AppUser.Email` to contain `'@'` (if your DB supports check on pattern).
4. Create table **Recommendation** `(RecID PK, FromUser, ToUser, Text, CreatedAt)` with FKs to `AppUser`.
5. Create table **Message** `(MsgID PK, FromUser, ToUser, Body, SentAt TIMESTAMP DEFAULT NOW())`.
6. Create view **v\_user\_summary** showing `UserID, FullName, City, total_connections (count of rows in Connection where user appears), total_followers`.
7. Create view **v\_company\_followers**: `CompanyID, Name, follower_count`.
8. Create table **Event** `(EventID PK, HostUserID FK, Title, StartAt TIMESTAMP, City)` and **EventAttendee** `(EventID, UserID, PRIMARY KEY(EventID,UserID))`.
9. Create table **PostMention** `(PostID, MentionedUserID, PRIMARY KEY(PostID, MentionedUserID))` with FKs.
10. Add `UNIQUE(FromUser, ToUser, SentAt)` to **Message** (simulate duplicate-prevention).
11. Drop view **v\_company\_followers** then recreate it with an extra column `top_city` (city with max followersâ€”if hard, leave NULL with a comment).
12. Drop column `OpenToHire` from **Profile** (assume itâ€™s deprecated).

### DML â€” Inserts/Updates/Deletes (13â€“20)

13. Insert two **Recommendations**: 101â†’104 (â€œgreat analystâ€), 104â†’101 (â€œreliable teammateâ€).
14. Insert four **Messages** among 101,102,103,104 (any content).
15. Update **Experience** to set `CurrentRole=TRUE` for 101 at Company 201 (and EndDate NULL).
16. Move 105 to city **â€œBhavnagarâ€**; update `Headline` to â€œDevOps Traineeâ€.
17. Remove all **reactions** of type `'LIKE'` on post 701 (keep others).
18. Insert a new **Event** â€œCG Career Fairâ€ by 201? (host must be a **UserID**; use 101), set attendees 101,102,104.
19. Add a **new post** by 103 about React performance with hashtags `#react`, `#codinggita` (insert tag `react` if missing).
20. Delete a **Comment** with `CommentID=801`.

### DQL â€” SELECT basics, filtering, sorting (21â€“30)

21. List all **users** with `FullName, Headline, City`, ordered by `FullName`.
22. Show **distinct cities** where users live.
23. List **posts** by 101 with their `CreatedAt`, newest first.
24. Find all **users open to work** (Profile.OpenToWork=TRUE).
25. List **comments** on post 701 showing commenter name and comment body.
26. Show **followers of 101** (names).
27. Show **users followed by 101**.
28. Display **companies** followed by 101.
29. List **jobs** that are **ACTIVE** in **Surat** or **Mumbai**, ordered by `PostedAt DESC`.
30. Show **users who never posted** (no rows in Post).

### Constraints (31â€“36)

31. Try inserting an **AppUser** with duplicate **Email**; capture the error in a comment.
32. Insert a **Reaction** duplicate (same PostID and UserID) to test `UNIQUE(PostID,UserID)`; capture error.
33. Add a `CHECK` on **Reaction.Type** to the existing list (already presentâ€”attempt an invalid type and record the error).
34. Add `UNIQUE(UserID, SkillID)` to **UserSkill** (already PK); attempt duplicate to show failure.
35. Add a `CHECK` on **Experience** to ensure `EndDate IS NULL OR EndDate >= StartDate`; test with a failing insert.
36. Add a `CHECK` on **Job.Employment**; test invalid value `'REMOTE'` to show it fails.

### Functions â€” Aggregates, string, numeric, date (37â€“47)

37. For each **post**, show counts: `reactions_count`, `comments_count`.
38. For each **user**, show `posts_count` and `followers_count`.
39. Show **UPPER(Headline)** and **email domain** (substring after `@`) for all users.
40. Show **month-wise post count** for 2025 (use `EXTRACT(MONTH FROM CreatedAt)` or `MONTH()`), ordered by month.
41. For each **company**, show **active job count** and **latest job date**.
42. Show **top 3 posts** by total reactions (ties allowed).
43. Find **avg endorsements per skill** (count of Endorsement grouped by SkillID).
44. Show **days since each job was posted** (date diff).
45. For each **user**, show **skills\_count** and **distinct endorsers\_count** (who endorsed any of their skills).
46. For each **hashtag**, show total **usage across posts**.
47. For each **group**, show **member\_count**, **admin\_count** (Role='ADMIN' or 'OWNER').

### Joins â€” INNER/LEFT/RIGHT/FULL/CROSS/SELF (48â€“56)

48. **INNER JOIN**: list `User FullName, Company Name, Title` for **current roles**.
49. **LEFT JOIN**: all users with their **latest postâ€™s CreatedAt** (NULL if none).
50. **RIGHT or FULL OUTER JOIN** (simulate if needed): list **all skills** and how many users have them (0 allowed).
51. **SELF JOIN**: pairs of users **in the same city**; avoid duplicate order (A,B) & (B,A).
52. **CROSS JOIN**: produce pairs of **hashtags Ã— employment types** from Job (distinct), limit first 20 rows.
53. Join **JobApplication â†’ Job â†’ Company** to show `ApplicantName, JobTitle, CompanyName, Status`.
54. Join **Reaction â†’ Post â†’ AppUser** to show who reacted to whose post (reactor â†’ author).
55. Find **mutual connections** between 101 and 104 using Connection table (users connected to both).
56. Show **followers who are not connections** for 101 (i.e., one-way followers).

### GROUP BY / HAVING (57â€“62)

57. Count **users per city** and filter `HAVING COUNT(*) >= 2`.
58. For each **company**, count **followers** and keep those with `>= 2`.
59. For each **skill**, count **endorsements** and keep those with `>= 2`.
60. For each **author**, show **avg reactions per post**; only authors with `AVG >= 1.0`.
61. For each **group**, count **members**; only groups with `member_count >= 2`.
62. For each **job location**, count **active jobs**; only locations with **>= 1**.

### ORDER BY (63â€“65)

63. List users sorted by **CreatedAt DESC**, tie-break by **FullName ASC**.
64. List posts ordered by **reactions\_count DESC**, tie-break by **CreatedAt DESC** (compute reactions via subquery).
65. List skills ordered by **number of users DESC**, then **skill name ASC**.

### Set Operations (66â€“68)

> If your engine lacks `INTERSECT/EXCEPT`, emulate via joins.

66. **UNION** of all **cities** from users and **HQCity** from companies (single column `CityName`), deduped.
67. **INTERSECT** (or emulation): cities that appear **both** as user cities and company HQ cities.
68. **EXCEPT/MINUS** (or emulation): user cities that are **not** any company HQ city.

### Subqueries â€” simple, correlated, EXISTS (69â€“75)

69. List users who posted **more than the average number of posts per user**.
70. List posts that have **more reactions than the average reactions per post**.
71. **Correlated**: list users whose **total endorsements** (for all their skills) is **above the overall average endorsements per user**.
72. **EXISTS**: list companies that **have at least one active job**.
73. **NOT EXISTS**: list users who **have no skills**.
74. For each user, show those who **applied to a job at a company they follow** (user follows company and has an application at that company).
75. Find users who **follow 101 but are not followed back by 101** (one-way followers).

---
